TODO
====

- Factor out a generic pair of functions rather than repeat the algorithm for each variant.
