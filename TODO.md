TODO
====

- Factor out the encoding and decoding tables.
- Factor out a generic pair of functions rather than repeat the algorithm for each variant.
